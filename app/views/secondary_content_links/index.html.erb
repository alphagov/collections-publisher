<%
  links = [
    {
      text: 'Step by step publisher',
      href: step_by_step_pages_path
    },
    {
      text: @step_by_step_page.title,
      href: step_by_step_page_path(@step_by_step_page)
    },
    {
      text: 'Secondary links'
    }
  ]
%>

<%= render 'shared/steps/step_breadcrumb', links: links %>

<%= render 'shared/steps/heading',
  step_nav: @step_by_step_page.title,
  action: 'Secondary links'
%>

<%= render '/step_by_step_pages/nav', step_by_step_page: @step_by_step_page, active:"secondary-links" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render "components/panel", {
      title: "What is secondary content?",
      body: capture do %>
        <p class="govuk-body-s">Secondary content is content which is not linked to in the step by step, but has the step by step sidebar showing on it.</p>
        <p class="govuk-body-s">We use it for content which:</p>
        <ul class="govuk-list govuk-list--bullet">
          <li class="govuk-body-s">helps you to complete a task in the journey, but is not the primary piece of content you need to visit to complete that task</li>
          <li class="govuk-body-s">is optional and not useful enough to be included in the step by step</li>
        </ul>
      <% end
    } %>
  </div>
</div>

<div class="govuk-grid-row govuk-!-margin-top-6 govuk-!-margin-bottom-6">
  <div class="govuk-grid-column-full">
    <%= form_for(@secondary_content_link, url: step_by_step_page_secondary_content_links_path) do |form| %>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <%= render "shared/steps/form_errors", resource: @step_by_step_page %>

          <%= render "govuk_publishing_components/components/heading", {
            text: "Add new secondary link",
            margin_bottom: 5
          } %>

          <%= render "govuk_publishing_components/components/input", {
            label: {
              text: "Base Path"
            },
            hint: capture do %>
              For example: 
              <a href="https://www.gov.uk/pay-vat" target="_blank" class="govuk-link">https://www.gov.uk/pay-vat</a> 
              or <a href="https://www.gov.uk/bank-holidays" class="govuk-link" target="_blank">/bank-holidays</a>
            <% end,
            name: "base_path"
          } %>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <%= render "govuk_publishing_components/components/button", {
            text: "Add secondary link"
          } %>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full govuk-!-margin-top-3">
          <%= link_to 'Cancel', step_by_step_page_secondary_content_links_path, class: "govuk-link add-secondary-link-cancel--link" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">


<div class="govuk-grid-row secondary-links">
  <div class="govuk-grid-column-full">
    <%= render "govuk_publishing_components/components/heading", {
      text: "Existing secondary links",
      margin_bottom: 5
    } %>

    <table class="govuk-table" data-module="filterable-table">
    <thead class="govuk-table__head">
      <tr>
        <th class="govuk-table__header" scope="col">Page title</th>
        <th class="govuk-table__header" scope="col">Path</th>
        <th class="govuk-table__header govuk-table__header--numeric" scope="col">Action</th>
      </tr>
    </thead>

    <tbody class="govuk-table__body">
      <% if @secondary_content_links.present? %>
        <% @secondary_content_links.each do |link| %>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><%= link_to(link.title, preview_url(link.base_path), class: "govuk-link") %></td>
            <td class="govuk-table__cell"><%= link.base_path %></td>
            <td class="govuk-table__cell govuk-table__cell--numeric">
              <%= link_to("Delete", step_by_step_page_secondary_content_link_path(@step_by_step_page.id, link.id), method: 'delete', data: { confirm: "Are you sure?" }, class: "gem-c-button govuk-button gem-c-button--warning") %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr class="govuk-table__row">
          <td class="govuk-table__cell" colspan="3">
            <p class="govuk-hint">No seconday links have been added yet.</p>
          </tr>
        </tr>
      <% end %>
    </tbody>
  </table>
  </div>
</div>

<% content_for :head do %>
  <%= stylesheet_link_tag 'admin_layout', media: 'all' %>
  <%= javascript_include_tag "admin_layout" %>
<% end %>
<%= render 'govuk_publishing_components/components/layout_for_admin',
  product_name: "Collections Publisher",
  environment: GovukPublishingComponents::AppHelpers::Environment.current_acceptance_environment,
  browser_title: yield(:page_title) do %>

  <%= render "govuk_publishing_components/components/skip_link" %>
  <%= render "govuk_publishing_components/components/layout_header", {
    product_name: "Publisher",
    environment: GovukPublishingComponents::AppHelpers::Environment.current_acceptance_environment,
    navigation_items: [
      {
        text: "Mainstream",
        href: mainstream_browse_pages_path,
        active: active_navigation_item == 'mainstream_browse_pages' ? 'active' : false,
        user_has_permission_to_see: gds_editor?
      },
      {
        text: "Topics",
        href: topics_path,
        active: active_navigation_item == 'topics' ? 'active' : false,
      },
      {
        text: "Step nav",
        href: step_by_step_pages_path,
        active: active_navigation_item == 'step_by_step_pages' ? 'active' : false,
        user_has_permission_to_see: gds_editor?
      },
      { text: "Switch app", href: Plek.new.external_url_for("signon") },
      { text: current_user.name, href: Plek.new.external_url_for("signon") },
      { text: "Log out", href: gds_sign_out_path }
    ].delete_if{ |item| item[:user_has_permission_to_see] == false },
  }%>
  <div class="govuk-width-container">
    <%= render "govuk_publishing_components/components/phase_banner", {
      app_name: "Collections Publisher",
      phase: "beta",
      message: capture do
        render "layouts/phase_banner_elements"
      end,
    } %>
    <% if yield(:back_link).present? %>
      <%= render "govuk_publishing_components/components/back_link", href: yield(:back_link) %>
    <% end %>

    <main class="govuk-main-wrapper" id="main-content" role="main">
      <% if flash["notice"].present? %>
        <%= render "govuk_publishing_components/components/success_alert", {
          message: flash["notice"]
        } %>
      <% end %>

      <% if flash["alert"].present? %>
        <%= render "govuk_publishing_components/components/error_alert", {
          message: flash["alert"]
        } %>
      <% end %>

      <%= yield(:breadcrumbs) %>

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
          <span class="govuk-caption-l"><%= yield(:context) %></span>
          <h1 class="govuk-heading-l"><%= yield(:title) %></h1>
        </div>
      </div>
      <%= yield %>
    </main>
  </div>

  <%= render "govuk_publishing_components/components/layout_footer", {
    navigation: [
      {
        title: "Support and feedback",
        items: [
          {
            href: Plek.new.external_url_for("support"),
            text: "Raise a support request"
          },
          {
            href: "https://www.gov.uk/government/content-publishing",
            text: "How to write, publish, and improve content"
          }
        ]
      }
    ]
  } %>
<% end %>
